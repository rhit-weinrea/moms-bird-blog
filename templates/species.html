{% extends 'layout.html' %}
{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/species.css') }}">
{% endblock %}
{% block content %}
  <h3 class="species-title">{{ species.name }}</h3>
  <p>
    <a class="btn btn-secondary" href="{{ url_for('new_post') }}?species_id={{ species.id }}">New Post for this Species</a>
    {% if session.editor_logged_in %}
      <a class="btn btn-outline-primary ml-2" href="{{ url_for('edit_species', species_id=species.id) }}">Edit Species</a>
      <form method="post" action="{{ url_for('delete_species', species_id=species.id) }}" class="inline-form" onsubmit="return confirm('Delete this species and all its posts?');">
        <button class="btn btn-danger ml-2" type="submit">Delete Species</button>
      </form>
    {% endif %}
  </p>
  {% if species.animals %}
    <div style="margin-bottom:12px">
      <strong>Animals</strong>
      <ul>
        {% for a in species.animals %}
          <li>
            {{ a.name }}
            {% if session.editor_logged_in %}
              <a class="btn btn-sm btn-link" href="{{ url_for('edit_animal', animal_id=a.id) }}">Edit</a>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
  {% if session.editor_logged_in %}
    <form method="post" action="{{ url_for('create_animal', species_id=species.id) }}" class="form-inline" style="margin-bottom:12px">
      <div class="form-group mr-2">
        <input name="name" class="form-control" placeholder="Add animal name" required>
      </div>
      <button class="btn btn-success" type="submit">Add Animal</button>
    </form>
  {% endif %}
  <div class="feed feed-center">
  {% for post in posts %}
    <div class="card mb-3 post-card">
      <div class="post-header centered">
        <div class="post-avatar"><img src="{{ url_for('static', filename='images/default_avatar.svg') }}" alt="avatar"></div>
        <div class="flex-fill">
          <div class="post-username">{{ post.user.name if post.user else "User" }}</div>
          <div class="post-time">{{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</div>
        </div>
      </div>

      <div class="image-wrapper-species">
        <img src="{{ url_for('uploaded_file', filename=post.image_filename) }}" class="post-img" alt="{{ post.caption }}">
      </div>

      <div class="post-actions">
        <div class="icon like">&#10084;</div>
        <div class="icon">&#128172;</div>
        <div class="icon">&#128257;</div>
        {% if session.editor_logged_in %}
          <form method="post" action="{{ url_for('delete_post', post_id=post.id) }}" class="inline-form" onsubmit="return confirm('Delete this post?');">
            <button class="btn btn-link text-danger" type="submit" title="Delete post">Delete</button>
          </form>
        {% endif %}
      </div>

      <div class="post-caption">
  <div><strong>{{ post.user.name if post.user else "User" }}</strong> <span class="text-muted">{{ post.species.name }}{% if post.animal_name %} â€¢ {{ post.animal_name }}{% endif %}</span></div>
        <div class="mt-2">{{ post.caption }}</div>
        {% if post.notes %}<div class="mt-2 text-muted small">{{ post.notes }}</div>{% endif %}
      </div>
    </div>
  {% else %}
    <p>No posts for this species yet.</p>
  {% endfor %}
  </div>
{% endblock %}